/* nanogallery2 - v0.0.2 - 2016-12-15 - http://nanogallery2.nanostudio.org */
/**!
 * @preserve nanogallery2 - GOOGLE PHOTOS data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(a){jQuery.nanogallery2.data_google=function(a,b){function c(a,b,c){var d=h.I[a].GetID();""==h.I[a].title&&(h.I[a].title=c.feed.title.$t),jQuery.each(c.feed.entry,function(a,c){var f=c.media$group.media$content[0].url,g=c.title.$t,i="",j=c.media$group.media$description.$t;"image"==b&&(i=g,""!=j&&(g=j,j=""),""!=h.O.thumbnailLabel.get("title")&&(g=m(unescape(unescape(unescape(unescape(f)))))));var k=c.gphoto$id.$t;if("album"!=b||n(g,k)){var l=NGY2Item.New(h,g,j,k,d,b,"");if("image"==b){var o="";if(o=f,!h.O.viewerZoom&&void 0!=h.O.viewerZoom){var p=f.substring(0,f.lastIndexOf("/"));p=p.substring(0,p.lastIndexOf("/"))+"/",o=window.screen.width>window.screen.height?p+"w"+window.screen.width+"/"+i:p+"h"+window.screen.height+"/"+i}l.src=o,l.imageWidth=parseInt(c.gphoto$width.$t),l.imageHeight=parseInt(c.gphoto$height.$t),null!=c.media$group&&null!=c.media$group.media$credit&&c.media$group.media$credit.length>0&&(l.author=c.media$group.media$credit[0].$t),void 0!=c.exif$tags.exif$exposure&&(l.exif.exposure=c.exif$tags.exif$exposure.$t),void 0!=c.exif$tags.exif$flash&&"true"==c.exif$tags.exif$flash.$t&&(l.exif.flash="flash"),void 0!=c.exif$tags.exif$focallength&&(l.exif.focallength=c.exif$tags.exif$focallength.$t),void 0!=c.exif$tags.exif$fstop&&(l.exif.fstop=c.exif$tags.exif$fstop.$t),void 0!=c.exif$tags.exif$iso&&(l.exif.iso=c.exif$tags.exif$iso.$t),void 0!=c.exif$tags.exif$model&&(l.exif.model=c.exif$tags.exif$model.$t),void 0!=c.gphoto$location&&(l.exif.location=c.gphoto$location)}else l.author=c.author[0].name.$t,l.numberItems=c.gphoto$numphotos.$t;l.thumbs=e("l1",0,l.thumbs,c,b),l.thumbs=e("lN",5,l.thumbs,c,b),"function"==typeof h.O.fnProcessData&&h.O.fnProcessData(l,"google",c)}}),h.I[a].contentIsLoaded=!0}function d(a,b){jQuery(document).queue("GoogleAlbumWithAuthkey",function(){var c=a.indexOf("&authkey=");c==-1&&(c=a.indexOf("?authkey="));var d=a.substring(0,c),f=a.substring(c);f.indexOf("Gv1sRg")==-1&&(f="&authkey=Gv1sRg"+f.substring(9));var g=Google.url()+"user/"+h.O.userID+"/albumid/"+d+"?alt=json&kind=photo"+f+"&max-results=1&thumbsize="+h.picasa.thumbSizes+"&imgmax=d";k(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var i=setTimeout(function(){k(!1),l("Could not retrieve AJAX data...")},6e4);jQuery.getJSON(g,function(a,c,g){clearTimeout(i),k(!1);var j=a.feed.title.$t,l=a.feed.entry[0],m=NGY2Item.New(h,j,"",d,"0","album","");m.authkey=f,m.thumbs=e("l1",0,m.thumbs,l,"album"),m.thumbs=e("lN",5,m.thumbs,l,"album"),"function"==typeof h.O.fnProcessData&&h.O.fnProcessData(m,"google",l),m.numberItems=a.feed.gphoto$numphotos.$t,jQuery(document).queue("GoogleAlbumWithAuthkey").length>0?jQuery(document).dequeue("GoogleAlbumWithAuthkey"):b()}).fail(function(a,b,c){clearTimeout(i),k(!1),l("Could not retrieve ajax data (google): "+b+", "+c),jQuery(document).dequeue("GoogleAlbumWithAuthkey")})})}function e(a,b,c,d,e){for(var f=["xs","sm","me","la","xl"],g=0;g<f.length;g++)if(c.url[a][f[g]]=d.media$group.media$thumbnail[b+g].url,"image"==e){c.width[a][f[g]]=d.media$group.media$thumbnail[b+g].width,c.height[a][f[g]]=d.media$group.media$thumbnail[b+g].height;var i=d.media$group.media$thumbnail[b+g].width,j=d.media$group.media$thumbnail[b+g].height;if("auto"==h.tn.settings.width[a][f[g]]&&j<h.tn.settings.height[a][f[g]]){var k=i/j;c.width[a][f[g]]=i*k,c.height[a][f[g]]=j*k;var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"h"+h.tn.settings.height[a][f[g]]+"/"}if("auto"==h.tn.settings.height[a][f[g]]&&i<h.tn.settings.width[a][f[g]]){var k=j/i;c.height[a][f[g]]=j*k,c.width[a][f[g]]=i*k;var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"w"+h.tn.settings.width[a][f[g]]+"/"}}else{if("auto"!=h.tn.settings.width[a][f[g]]);else{var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"h"+h.tn.settings.height[a][f[g]]+"/"}if("auto"!=h.tn.settings.height[a][f[g]]);else{var l=c.url[a][f[g]].substring(0,c.url[a][f[g]].lastIndexOf("/"));l=l.substring(0,l.lastIndexOf("/"))+"/",c.url[a][f[g]]=l+"w"+h.tn.settings.width[a][f[g]]+"/"}}return c}function f(){h.picasa={thumbSizes:""};var a=1;h.thumbnailCrop.l1===!0&&(a=h.O.thumbnailCropScaleFactor);var b=1;h.thumbnailCrop.lN===!0&&(b=h.O.thumbnailCropScaleFactor),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.l1.xs*a,h.tn.settings.height.l1.xs*a,h.tn.settings.width.l1.xsc,h.tn.settings.height.l1.xsc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.l1.sm*a,h.tn.settings.height.l1.sm*a,h.tn.settings.width.l1.smc,h.tn.settings.height.l1.smc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.l1.me*a,h.tn.settings.height.l1.me*a,h.tn.settings.width.l1.mec,h.tn.settings.height.l1.mec),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.l1.la*a,h.tn.settings.height.l1.la*a,h.tn.settings.width.l1.lac,h.tn.settings.height.l1.lac),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.l1.xl*a,h.tn.settings.height.l1.xl*a,h.tn.settings.width.l1.xlc,h.tn.settings.height.l1.xlc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.lN.xs*b,h.tn.settings.height.lN.xs*b,h.tn.settings.width.lN.xsc,h.tn.settings.height.lN.xsc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.lN.sm*b,h.tn.settings.height.lN.sm*b,h.tn.settings.width.lN.smc,h.tn.settings.height.lN.smc),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.lN.me*b,h.tn.settings.height.lN.me*b,h.tn.settings.width.lN.mec,h.tn.settings.height.lN.mec),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.lN.la*b,h.tn.settings.height.lN.la*b,h.tn.settings.width.lN.lac,h.tn.settings.height.lN.lac),h.picasa.thumbSizes=g(h.picasa.thumbSizes,h.tn.settings.width.lN.xl*b,h.tn.settings.height.lN.xl*b,h.tn.settings.width.lN.xlc,h.tn.settings.height.lN.xlc)}function g(a,b,c,d,e){var f=Math.ceil(c*h.tn.scale)+e;return"auto"==b?f=Math.ceil(c*h.tn.scale)+e:"auto"==c?f=Math.ceil(b*h.tn.scale)+d:b>c&&(f=Math.ceil(b*h.tn.scale)+d),a.length>0&&(a+=","),a+=f}var h=a;Google={url:function(){return"https://photos.googleapis.com/data/feed/api/"},thumbSize:64,thumbAvailableSizes:new Array(32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600),thumbAvailableSizesCropped:" 32 48 64 72 104 144 150 160 "};var i=function(a,b,d,e){var f=Google.url()+"user/"+h.O.userID,g="image",i=NGY2Item.GetIdx(h,a),j="";if(h.galleryMaxItems.Get()>0&&(j="&max-results="+h.galleryMaxItems.Get()),0==h.I[i].GetID())f+="?alt=json&kind=album&thumbsize="+h.picasa.thumbSizes+j+"&rnd="+(new Date).getTime(),g="album";else{var m="";""!=h.I[i].authkey&&(m=h.I[i].authkey),f+="/albumid/"+a+"?alt=json&kind=photo&thumbsize="+h.picasa.thumbSizes+j+m+"&imgmax=d"}k(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;try{var n=setTimeout(function(){k(!1),l("Could not retrieve AJAX data...")},6e4),p=function(f){clearTimeout(n),k(!1),c(i,g,f),o(a),null!==b&&void 0!==b&&b(d,e,null)},q=null,r=function(a,b){jQuery.getJSON(a+"&start-index="+b,"callback=?",function(b){null===q?q=b:GI_data_loaded.feed.entry=q.feed.entry.concat(b.feed.entry),b.feed.openSearch$startIndex.$t+b.feed.openSearch$itemsPerPage.$t>=b.feed.openSearch$totalResults.$t?p(q):r(a,b.feed.openSearch$startIndex.$t+b.feed.openSearch$itemsPerPage.$t)}).fail(function(b,c,d){clearTimeout(n),k(!1);var e="";for(var f in b)e+=f+"="+b[f]+"<br>";var g=c+", "+d+" "+e+"<br><br>URL:"+a;l("Could not retrieve Google data. Error: "+g)})};r(f,1)}catch(s){l("Could not retrieve Google data. Error: "+s)}},j=function(a,b){for(var c=[].concat(a),e=0;e<c.length;e++)d(c[e],b);jQuery(document).dequeue("GoogleAlbumWithAuthkey")},k=NGY2Tools.PreloaderDisplay.bind(h),l=NGY2Tools.NanoAlert.bind(h),m=NGY2Tools.GetImageTitleFromURL.bind(h),n=NGY2Tools.FilterAlbumName.bind(h),o=NGY2Tools.AlbumPostProcess.bind(h);switch(b){case"GetHiddenAlbums":var p=arguments[2],q=arguments[3];j(p,q);break;case"AlbumGetContent":var r=arguments[2],q=arguments[3],s=arguments[4],t=arguments[5];i(r,q,s,t);break;case"Init":f();break;case"":break;case"":}}}(jQuery),function(a){jQuery.nanogallery2.data_flickr=function(a,b){function c(a,b){var c="";c="NONE"==h.O.photoset.toUpperCase()||"NONE"==h.O.album.toUpperCase()?b.photos.photo:b.photoset.photo;var d=h.I[a].GetID();jQuery.each(c,function(a,b){for(var c=b.title,f=b.id,g=b.description._content,i=b.url_sq,a=j.photoSize;a>=0;a--)if(void 0!=b["url_"+j.photoAvailableSizesStr[a]]){i=b["url_"+j.photoAvailableSizesStr[a]];break}var k={};for(var l in b)0!=l.indexOf("height_")&&0!=l.indexOf("width_")&&0!=l.indexOf("url_")||(k[l]=b[l]);""!=h.O.thumbnailLabel.get("title")&&(c=o(i)),tags="",void 0!==b.tags&&(tags=b.tags);var m=NGY2Item.New(h,c,g,f,d,"image",tags);m.src=i,void 0!==b.url_o?(m.width=b.width_o,m.height=b.height_o):(m.width=b.width_z,m.height=b.height_z);var n={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};n=e(n,b,"l1"),n=e(n,b,"lN"),m.thumbs=n}),h.I[a].contentIsLoaded=!0}function d(a,b){if(void 0!==b.stat&&"fail"===b.stat)return n("Could not retrieve Flickr photoset list: "+b.message+" (code: "+b.code+")."),!1;var c=h.I[a].GetID(),d=b.photosets.photoset;jQuery.each(d,function(a,b){if(itemTitle=b.title._content,p(itemTitle,b.id)){itemID=b.id,itemDescription="",void 0!=b.description._content&&(itemDescription=b.description._content);var d={};for(var f in b.primary_photo_extras)d[f]=b.primary_photo_extras[f];tags="",void 0!==b.primary_photo_extras&&void 0!==b.primary_photo_extras.tags&&(tags=b.primary_photo_extras.tags);var g=NGY2Item.New(h,itemTitle,itemDescription,itemID,c,"album",tags);g.numberItems=b.photos,g.thumbSizes=d;var i={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};i=e(i,b.primary_photo_extras,"l1"),i=e(i,b.primary_photo_extras,"lN"),g.thumbs=i}}),h.I[a].contentIsLoaded=!0}function e(a,b,c){var d=1;h.thumbnailCrop[c]===!0&&(d=h.O.thumbnailCropScaleFactor);for(var e=["xs","sm","me","la","xl"],g=0;g<e.length;g++)if("auto"==h.tn.settings.width[c][e[g]]||""==h.tn.settings.width[c][e[g]]){var i="height_",j=Math.ceil(h.tn.settings.height[c][e[g]]*h.tn.scale*d),k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}else if("auto"==h.tn.settings.height[c][e[g]]||""==h.tn.settings.height[c][e[g]]){var i="width_",j=Math.ceil(h.tn.settings.width[c][e[g]]*h.tn.scale*d),k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}else{var i="height_",j=Math.ceil(h.tn.settings.height[c][e[g]]*h.tn.scale*d);h.tn.settings.width[c][e[g]]>h.tn.settings.height[c][e[g]]&&(i="width_",j=Math.ceil(h.tn.settings.width[c][e[g]]*h.tn.scale*d));var k=f(i,j,b);a.url[c][e[g]]=k.url,a.width[c][e[g]]=k.width,a.height[c][e[g]]=k.height}return a}function f(a,b,c){for(var d={url:"",width:0,height:0},e=0,f=0;f<j.thumbAvailableSizes.length;f++){var g=c[a+j.photoAvailableSizesStr[f]];if(void 0!=g&&(e=f,g>=b))break}var h=j.photoAvailableSizesStr[e];return d.url=c["url_"+h],d.width=parseInt(c["width_"+h]),d.height=parseInt(c["height_"+h]),d}function g(){}var h=a,j={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k"),ApiKey:"2f0e634b471fdb47446abcb9c5afebdc"},k=function(a,b,e,f){var g=NGY2Item.GetIdx(h,a),i="",k="image";"NONE"==h.O.photoset.toUpperCase()||"NONE"==h.O.album.toUpperCase()?i=j.url()+"?&method=flickr.people.getPublicPhotos&api_key="+j.ApiKey+"&user_id="+h.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json&jsoncallback=?":0==h.I[g].GetID()?(i=j.url()+"?&method=flickr.photosets.getList&api_key="+j.ApiKey+"&user_id="+h.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json&jsoncallback=?",k="album"):i=j.url()+"?&method=flickr.photosets.getPhotos&api_key="+j.ApiKey+"&photoset_id="+h.I[g].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json&jsoncallback=?",m(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var l=setTimeout(function(){m(!1),n("Could not retrieve AJAX data...")},6e4);jQuery.getJSON(i,function(h,i,j){clearTimeout(l),m(!1),"album"==k?d(g,h):c(g,h),q(a),null!==b&&void 0!==b&&b(e,f,null)}).fail(function(a,b,c){clearTimeout(l),m(!1),n("Could not retrieve ajax data (Flickr): "+b+", "+c)})},l=function(a,b){b()},m=NGY2Tools.PreloaderDisplay.bind(h),n=NGY2Tools.NanoAlert.bind(h),o=NGY2Tools.GetImageTitleFromURL.bind(h),p=NGY2Tools.FilterAlbumName.bind(h),q=NGY2Tools.AlbumPostProcess.bind(h),r=Math.max(window.screen.width,window.screen.height);for(void 0!=window.devicePixelRatio&&window.devicePixelRatio>1&&(r*=window.devicePixelRatio),h.O.flickrSkipOriginal||(j.photoAvailableSizes.push(1e4),j.photoAvailableSizesStr.push("o")),i=0;i<j.photoAvailableSizes.length&&(j.photoSize=i,!(r<=j.photoAvailableSizes[i]));i++);switch(b){case"GetHiddenAlbums":var s=arguments[2],t=arguments[3];l(s,t);break;case"AlbumGetContent":var u=arguments[2],t=arguments[3],v=arguments[4],w=arguments[5];k(u,t,v,w);break;case"Init":g();break;case"":break;case"":}}}(jQuery);